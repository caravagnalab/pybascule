---
title: "SigPhylo"
author: "Azad Sadr"
date: "4/13/2022"
output:
  html_document: default
  pdf_document: default
  toc: true
  toc_depth: 2
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r get_utilities, echo=FALSE, include=FALSE}
#use_condaenv("SigPhylo")
source("utilities.R")
setwd("/home/azad/Documents/thesis/SigPhylo/BaySig") # change the directory
source_python("main.py")
```


```{r, echo=FALSE}
alpha_target <- py_to_r(data[[1]])
beta_target <- py_to_r(data[[2]])
beta_fixed <- py_to_r(data[[3]])
alpha_inferred <- py_to_r(data[[4]])
beta_inferred <- py_to_r(data[[5]])
Accuracy <- data[[6]]
Precision <- data[[7]]
Recall <- data[[8]]
F1 <- data[[9]]
alpha_mse <- data[[10]]
GoF <- data[[11]]
```
### Target vs. Inferred Relative Exposure and Error (Alpha)
```{r, echo=FALSE}
alpha_target <- alpha_target[order(names(alpha_target))]
alpha_target

paste("Input Fixed Signatures:", paste(unlist(rownames(beta_fixed)), collapse=", "), sep = " ")
alpha_inferred <- alpha_inferred[order(names(alpha_inferred))]
alpha_inferred

alpha_inferred - alpha_target
plot_alpha_error(alpha_inferred - alpha_target, "error")
```

### Visualize Target vs. Inferred Relative Exposure (Alpha)
```{r, echo=FALSE}
a_taget <- plot_alpha(alpha_target, "Alpha Target")
a_inferred <- plot_alpha(alpha_inferred, "Alpha Inferred")
ggarrange(a_taget, a_inferred, ncol = 2)
```

### Visualize Target vs. Inferred Signature Profles (Beta)
```{r, echo=FALSE}
b_target <- plot_beta(beta_target, "Beta Target")
b_inferred <- plot_beta(beta_inferred, "Beta Inferred")
ggarrange(b_target, b_inferred, ncol = 2)
```

```{r, echo=FALSE}
# Expected Beta
#beta_expected <- input[["Beta_Expected"]][[1]]

# Inferred Beta (lowest BIC)
#beta_denovo <- beta_read_tibble(data, k_bic, lambda_bic)
#beta_denovo_labeled <- beta_labeling(beta_expected, beta_denovo)
```





\begin{center}
THE END
\end{center}


```{r STORAGE, echo=FALSE}
#data
#data[["Cosine"]][[5]]
# Inferred vs Expected Beta

#cosmic_path <- "/home/azad/Documents/thesis/SigPhylo/cosmic/cosmic_catalogue.csv"
#SBS1 <- beta_read_csv(cosmic_path)["SBS1", ]  # SBS1 from cosmic
#expected_path <- "/home/azad/Documents/thesis/SigPhylo/data/real/expected_beta.csv"
#Unknown <- beta_read_csv(expected_path)["Signature 3(missing from COSMIC)", ] # missing from cosmic
#rownames(Unknown) <- "Unknown"
#beta_expected <- rbind(SBS1, Unknown)
#-------------------------------------------------------------------------------

# SBS1 -------------------------------------------------------------------------
#glist_SBS1 <- list()
#glist_SBS1[[1]] <- plot_beta(SBS1)
#glist_SBS1[[2]] <- plot_beta(beta_denovo_labeled["SBS1", ])

#a1 <- as.numeric(SBS1)  # numeric vector of expected SBS1
#b1 <- as.numeric(beta_denovo_labeled["SBS1", ])  # numeric vector of inferred SBS1
#cosine_SBS1 <- cosine_sim(a1, b1)

#gplot_SBS1 <- ggarrange(plotlist = glist_SBS1, 
#                        ncol = 1, 
#                        #nrow = nrow, 
#                        common.legend = TRUE, 
#                        legend = "bottom")

# Unknown ----------------------------------------------------------------------
#glist_Unknown <- list()
#glist_Unknown[[1]] <- plot_beta(beta_expected["Unknown", ])
#glist_Unknown[[2]] <- plot_beta(beta_denovo_labeled["Unknown", ])

#a2 <- as.numeric(beta_expected["Unknown", ])  # numeric vector of expected Unknown
#b2 <- as.numeric(beta_denovo_labeled["Unknown", ]) # numeric vector of inferred Unknown
#cosine_Unknown <- cosine_sim(a2, b2)

#gplot_Unknown <- ggarrange(plotlist = glist_Unknown, 
#                           ncol = 1, 
                           #nrow = nrow, 
#                           common.legend = TRUE, 
#                           legend = "bottom")


#```{r, echo=FALSE}
'
### Visualize Inferred vs. Expected Signature Profiles (Beta)
first plots represent expected signature and second plots represent inferred signature.

for (i in 1:nrow(beta_expected)) {
  exp <- beta_expected[i, ] # data.frame
  label <- rownames(exp)
  inf <- beta_denovo_labeled[label, ] # data.frame
  cosine <- cosine_sim(as.numeric(exp), as.numeric(inf))
  rownames(inf) <- paste(rownames(inf), "cosine =", format(round(cosine, 3), nsmall = 3))
  compare <- rbind(exp, inf)
  
  cat(paste("Signature:", 
            rownames(exp), 
            "=================================================================="))
  print(plot_beta(compare))
}
'
```




```






